<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title data-i18n="header.title.boutique">Boutique</title>
  <link rel="stylesheet" href="style/main.css" />
  <style>
    /* S√©curit√© d‚Äôaffichage si le CSS global ne g√®re pas ces classes */
    #popup-achat-jeton.hidden,
    #popup-achat-pieces.hidden,
    #popup-premium.hidden { display:none !important; }

    /* S'assure que les popups passent devant tout */
    #popup-achat-jeton,
    #popup-achat-pieces,
    #popup-premium { position: fixed; inset: 0; z-index: 9999; }
  </style>
</head>
<body class="boutique-container">

  <header class="header-solo">
    <div class="header-row">
      <a href="index.html" class="back-btn" title="Retour" data-i18n-title="header.back">
        <img src="assets/icons/arrow_back.svg" alt="Retour" data-i18n-alt="header.back"/>
      </a>
      <h1 data-i18n="header.title.boutique">Boutique</h1>
      <div class="top-buttons">
        <a href="profil.html" class="btn-icon">
          <img src="assets/icons/user.svg" alt="Profil" />
        </a>
        <a href="parametres.html" class="btn-icon">
          <img src="assets/icons/settings.svg" alt="Param√®tres" data-i18n-alt="button.settings" />
        </a>
      </div>
    </div>
  </header>

  <!-- LIGNE 1 : SOLDES -->
  <div class="solde-ligne-boutique">
    <div class="solde-item">
      <img src="assets/img/vcoin.webp" class="icon-boutique-piece" />
      <span id="points">0</span>
    </div>
    <div class="solde-item">
      <img src="assets/img/jeton_p.webp" class="icon-boutique-jeton" />
      <span id="jetons">0</span>
    </div>
  </div>

  <!-- PREMIUM CTA -->
  <div class="premium-btn-row">
    <button class="btn-boutique-pill btn-boutique-fullwidth" onclick="activerPremium()" data-i18n="button.premium">
      Passer Premium
    </button>
  </div>

  <!-- Boutons jetons/pi√®ces -->
  <div class="btn-boutique-inline">
    <button class="btn-boutique-pill-jetonpiece" onclick="ouvrirPopupPiecesBoutique()" data-i18n="button.getcoins">
      Obtenir pi√®ces
    </button>
    <button class="btn-boutique-pill-jetonpiece" onclick="ouvrirPopupJetonBoutique()" data-i18n="button.gettokens">
      Acheter jetons
    </button>
  </div>

  <!-- SECTION BOUTIQUE (cadres) -->
  <section class="cadres-list">
    <div id="boutique-categories"></div>
    <div id="boutique-container"></div>
  </section>

  <footer>
    <p data-i18n="footer">&copy; 2025 VFind</p>
  </footer>

  <!-- ‚úÖ POPUP : ACHETER DES JETONS -->
  <div id="popup-achat-jeton" class="hidden">
    <div class="popup-inner popup-premium-pro" style="max-width:420px;">
      <div class="premium-badge" data-i18n="popup.tokens.badge">JETONS</div>
      <div class="popup-premium-title" data-i18n="popup.tokens.title_generic">Obtenir des jetons</div>
      <div class="popup-premium-price" style="margin-bottom: 14px;" data-i18n="popup.tokens.method">
        Choisis une m√©thode
      </div>

      <!-- M√©thodes 1 jeton -->
      <div class="premium-list-pro" style="margin-bottom:10px;">
        <button class="btn-premium-pro" onclick="acheterJetonAvecPieces()" data-i18n="popup.tokens.paywithcoins_1">
          üí∏ Payer 100 pi√®ces (1 jeton)
        </button>
        <button class="btn-premium-pro" onclick="acheterJetonAvecPub()" data-i18n="popup.tokens.paywithad_1">
          üì∫ Regarder une pub (1 jeton)
        </button>
      </div>

      <div style="opacity:.6;font-size:.9em;margin:2px 0 10px" data-i18n="popup.or">ou</div>

      <!-- Packs Store : 12 / 50 jetons -->
      <div class="premium-list-pro packs-list" style="gap:10px; width:100%;">
        <button class="btn-premium-pro" onclick="acheterPackJetons('tokens_12')">
          <span data-i18n="popup.tokens.pack12">12 jetons</span>
          <span id="price-tokens_12" style="margin-left:8px">‚Äî</span>
        </button>
        <button class="btn-premium-pro" onclick="acheterPackJetons('tokens_50')">
          <span data-i18n="popup.tokens.pack50">50 jetons</span>
          <span id="price-tokens_50" style="margin-left:8px">‚Äî</span>
        </button>
      </div>

      <button class="btn-annuler-premium-pro" onclick="fermerPopupJetonBoutique()" data-i18n="button.cancel" style="margin-top:14px;">
        Annuler
      </button>
    </div>
  </div>

  <!-- ‚úÖ POPUP : OBTENIR DES PI√àCES -->
  <div id="popup-achat-pieces" class="hidden">
    <div class="popup-inner popup-premium-pro" style="max-width:420px;">
      <div class="premium-badge" data-i18n="popup.coins.badge">PI√àCES</div>
      <div class="popup-premium-title" data-i18n="popup.coins.title">Obtenir des pi√®ces</div>
      <div class="popup-premium-price" style="margin-bottom:14px;" data-i18n="popup.coins.method">
        Choisis une m√©thode
      </div>

      <!-- M√©thodes gratuites/indirectes (fixes) -->
      <div class="premium-list-pro" style="margin-bottom:10px;">
        <button class="btn-premium-pro" onclick="acheterPiecesAvecPub()" data-i18n="popup.coins.ad">
           Voir une pub (+100)
        </button>
        <button class="btn-premium-pro" onclick="acheterPiecesParrainage()" data-i18n="popup.coins.invite">
           Inviter un ami (+300)
        </button>
      </div>

      <div style="opacity:.6;font-size:.9em;margin:2px 0 10px" data-i18n="popup.or">ou</div>

      <!-- Packs IAP (prix dynamiques) -->
      <div class="premium-list-pro packs-list" style="gap:10px; width:100%;">
        <button class="btn-premium-pro" onclick="acheterPackPieces('coins_099')">
          1&nbsp;500 <span id="price-coins_099" style="margin-left:8px">‚Äî</span>
        </button>
        <button class="btn-premium-pro" onclick="acheterPackPieces('coins_199')">
          4&nbsp;500 <span id="price-coins_199" style="margin-left:8px">‚Äî</span>
        </button>
        <button class="btn-premium-pro" onclick="acheterPackPieces('coins_399')">
          12&nbsp;000 <span id="price-coins_399" style="margin-left:8px">‚Äî</span>
        </button>
        <button class="btn-premium-pro" onclick="acheterPackPieces('coins_999')">
          30&nbsp;000 <span id="price-coins_999" style="margin-left:8px">‚Äî</span>
        </button>
      </div>

      <button class="btn-annuler-premium-pro" onclick="fermerPopupPiecesBoutique()" data-i18n="button.cancel" style="margin-top:14px;">
        Annuler
      </button>
    </div>
  </div>

  <!-- ‚úÖ POPUP PREMIUM -->
  <div id="popup-premium" class="hidden">
    <div class="popup-inner popup-premium-pro">
      <div class="premium-badge" data-i18n="popup.premium.badge">PREMIUM</div>
      <div class="popup-premium-title" data-i18n="popup.premium.title">Passe √† Premium</div>
      <div class="popup-premium-price">
        <span id="premium-price">‚Äî</span><span class="premium-prix-mini" data-i18n="popup.premium.permonth">/mois</span>
      </div>
      <ul class="premium-list-pro">
        <li><b data-i18n="popup.premium.x2coins.bold">Pi√®ces x2</b> <span data-i18n="popup.premium.x2coins.text">sur chaque d√©fi valid√©</span></li>
        <li><b data-i18n="popup.premium.cadres.bold">Cadres exclusifs</b> <span data-i18n="popup.premium.cadres.text">r√©serv√©s</span></li>
        <li><b data-i18n="popup.premium.bonus.bold">500 pi√®ces</b> <span data-i18n="popup.premium.bonus.text">offertes chaque mois</span></li>
        <li><b data-i18n="popup.premium.defi.bold">Impose un d√©fi</b> <span data-i18n="popup.premium.defi.text">parmi 10 choix</span></li>
        <li><b data-i18n="popup.premium.id.bold">ID personnalis√©</b></li>
        <li><b data-i18n="popup.premium.exclu.bold">Jeu exclusif :</b> <span data-i18n="popup.premium.exclu.text">impose tes d√©fis √† tes amis</span></li>
        <li><b data-i18n="popup.premium.noads.bold">Pas de pub</b></li>
        <li><b data-i18n="popup.premium.x2votes.bold">2x plus de votes</b> <span data-i18n="popup.premium.x2votes.text">en concours</span></li>
        <li><b data-i18n="popup.premium.love.bold">L'amour de l'√©quipe</b></li>
      </ul>
      <button class="btn-premium-pro" onclick="acheterPremium()" data-i18n="popup.premium.subscribe">
        Devenir Premium
      </button>
      <button class="btn-annuler-premium-pro" onclick="fermerPopupPremium()" data-i18n="button.cancel">
        Annuler
      </button>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="js/i18n.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="js/userData.js"></script>
  <script src="js/pub.js"></script>
  <script src="js/boutique.js"></script>
  <script src="js/achat.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (window.afficherSolde) window.afficherSolde();

      // Demande au store de rafra√Æchir les produits (tes wrappers natifs)
      if (window.refreshStoreProducts) window.refreshStoreProducts();

      // Prix Premium dynamique
      setTimeout(() => {
        const el = document.getElementById('premium-price');
        if (el && window.getStorePrice) el.textContent = window.getStorePrice('premium') || '‚Äî';
      }, 800);
    });
  </script>
</body>
</html>
